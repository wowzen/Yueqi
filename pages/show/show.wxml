<!-- 
This page will look different based on below conditions:
  currentUser = creator_id ==> "set event data button"
  if before deadline ==> "warning: It is before the deadline, do you want to confirm?"
  if after deadline ==> "warning: are you sure?" OK, confirmed
currentUser = invitee_id && submitted availability 
  if event date is set ==> only show invitation with event details  
  if date is not set ==> change availability button 
currentUser = invitee_id && has not submitted availability ==> 
  if event date is set ==> only show invitation with event details  
  if date is not set ==> submit availability button  -->
<view class="container">
  <view class="card">
    <image class="image" src="{{testImage}}" />
    <view class="activity">{{event.activity}}</view>
    <view class="occasion">For {{event.occasion}}</view>
    <view class="nickname">Organized by: {{event.creator_id.nickname}}</view>
    <view class="">Response deadline: {{event.response_deadline}}</view>
  </view>

  <view wx:if="{{currentUser.id == event.creator_id.id}}">
    <view wx:if="{{event.confirmed_date == '' || confirmedSlot == undefined}}">
      <view>Select the event date</view>
      <radio-group bindchange="chooseDate">
        <label wx:for="{{slots}}" data-chosenSlot="{{slot.start_date}}" wx:for-item="slot" wx:key="id">
          <view class="date-cell">
            {{slot.start_date}} to {{slot.end_date}}
            <radio value="{{slot.id}}"/>
            <view><progress percent="{{slot.response_progress}}"></progress></view>
          </view>
        </label>
      </radio-group>
    </view>

    <view wx:if="{{dateSelected && event.confirmed_date == ''}}">
      <button wx:if="{{!confirmedSlot}}" class="button" bindtap="{{deadlinePassed ? 'setFinalDate' : 'setFinalDateEarly'}}">Set final event date</button>
      <button wx:else class="button" bindtap="{{changeFinalDate}}">Change final event date</button>
    </view>
  </view>

  <view wx:else>
    <view wx:if="{{event.confirmed_date.length == 0 && availabilitySubmitted == false}}">
      <view wx:if="{{slots.length > 0}}">Confirm your availability</view>
      <checkbox-group bindchange="chooseMultiDate">
        <label wx:for="{{slots}}" data-chosenSlot="{{slot.start_date}}" wx:for-item="slot" wx:key="id" >
          <view class="date-cell">{{slot.start_date}} to {{slot.end_date}}
            <checkbox value="{{slot.id}}"/>
            <view>{{slot.response_yes}}</view>
            <view>{{slot.response_total}}</view>
            <view><progress percent="{{slot.response_progress}}"></progress></view>
          </view>
        </label>
      </checkbox-group>
      <button bindtap="submitResponse">Submit availability</button>
    </view>

    <!-- <view wx:elif="{{event.confirmed_date == '' && event.creator_id.id != currentUser.id && availabilitySubmitted == false}}"> -->
    
    <!-- </view> -->

    <view wx:if="{{event.confirmed_date.length != 0 || availabilitySubmitted == true}}">
      <view>Your availability has been confirmed.</view>
      <view>Below you can see participant availability as confirmed so far. More participants may yet provide availability.</view>
      <view>Wait for the organizer to set the event date. You will receive a notification in your WeChat notifications.</view>
      <view wx:for="{{slots}}" wx:for-item="slot" wx:key="id">
        <view>{{slot.start_date}} to {{slot.end_date}}</view>
        <view><progress percent="{{slot.response_progress}}"></progress></view>
      </view>

    </view>
  </view>

  <view wx:if="{{event.confirmed_date != ''}}"> 
    <view>Event date & time: </view>
    <view>{{confirmedSlot.start_date}} to {{confirmedSlot.end_date}}</view>
  </view>

  <button wx:if="{{currentUser.id == event.creator_id.id}}" class="button" open-type="share">Invite friends</button>
</view>
